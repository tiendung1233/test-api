<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee Affiliate Crawler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="glass-background"></div>

    <main class="container">
        <header>
            <div class="logo">
                <span class="icon">ğŸš€</span>
                <h1>Shopee Crawler</h1>
            </div>
            <p class="subtitle">TrÃ¬nh trÃ­ch xuáº¥t dá»¯ liá»‡u sáº£n pháº©m Affiliate siÃªu tá»‘c</p>
        </header>

        <section class="card">
            <div class="input-group">
                <input type="text" id="productId" placeholder="Nháº­p ID sáº£n pháº©m (VD: 26776911695)" value="26776911695">
                <button id="crawlBtn">
                    <span class="btn-text">Báº¯t Ä‘áº§u Crawl</span>
                    <span class="loader"></span>
                </button>
            </div>
            <div class="notice">
                <p>ğŸ’¡ <strong>LÆ°u Ã½:</strong> Khi trÃ¬nh duyá»‡t má»Ÿ ra, náº¿u bá»‹ há»i CAPTCHA hoáº·c ÄÄƒng nháº­p, hÃ£y thao tÃ¡c thá»§
                    cÃ´ng. Script sáº½ tá»± Ä‘á»£i báº¡n xong!</p>
            </div>
        </section>

        <section id="resultCard" class="card result-card hidden">
            <h3>ğŸ¯ Káº¿t quáº£ trÃ­ch xuáº¥t</h3>
            <div class="result-content">
                <div class="result-item highlight">
                    <span class="label">ğŸ”— Affiliate Link</span>
                    <span class="value small" id="resAffiliateLink"
                        style="word-break: break-all; user-select: all;">---</span>
                </div>
                <div class="result-item">
                    <span class="label">ğŸ“ URL Trang</span>
                    <span class="value small" id="resUrl">---</span>
                </div>
            </div>
            <div class="status-bar" id="statusBar">
                Äang chá» lá»‡nh...
            </div>
        </section>
    </main>

    <script>
        const crawlBtn = document.getElementById('crawlBtn');
        const productIdInput = document.getElementById('productId');
        const resultCard = document.getElementById('resultCard');
        const statusBar = document.getElementById('statusBar');

        const resAffiliateLink = document.getElementById('resAffiliateLink');
        const resUrl = document.getElementById('resUrl');

        crawlBtn.addEventListener('click', async () => {
            const id = productIdInput.value.trim();
            if (!id) return alert('Vui lÃ²ng nháº­p ID sáº£n pháº©m');

            // UI State: Loading
            crawlBtn.classList.add('loading');
            crawlBtn.disabled = true;
            resultCard.classList.remove('hidden');
            statusBar.textContent = 'TrÃ¬nh duyá»‡t Ä‘ang khá»Ÿi Ä‘á»™ng... vui lÃ²ng kiá»ƒm tra terminal/mÃ n hÃ¬nh';
            statusBar.className = 'status-bar processing';

            try {
                const response = await fetch(`/api/crawl?id=${id}`);
                const data = await response.json();

                if (data.error) {
                    statusBar.textContent = 'Lá»—i: ' + data.error;
                    statusBar.className = 'status-bar error';
                } else {
                    resAffiliateLink.textContent = data.affiliateLink || 'N/A';
                    resUrl.textContent = data.url || 'N/A';
                    statusBar.textContent = 'âœ… ÄÃ£ láº¥y link thÃ nh cÃ´ng!';
                    statusBar.className = 'status-bar success';
                }
            } catch (err) {
                statusBar.textContent = 'Lá»—i káº¿t ná»‘i server';
                statusBar.className = 'status-bar error';
            } finally {
                crawlBtn.classList.remove('loading');
                crawlBtn.disabled = false;
            }
        });
    </script>
</body>

</html>